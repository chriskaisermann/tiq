!function(t){var e=function(t){return t&&"function"==typeof t},o=function(t,o){if(!e(o))throw"Tiq: Invalid callback";return this[t]=o,this},r=function(t){this.queue=t||[],this.current=-1,this.numberOfLoops=1,this.shouldPlay=!1};r.prototype.add=function(t,o,r){var u=this;if(r=r||1,!e(o))throw"Tiq: Invalid callback";for(var i=0;i<r;i++)u.queue.push([t,o]);return this},r.prototype.run=function(){var t,e=this,o=0,r=0,u=0;if(this.shouldPlay=!0,this.beforeCallback&&this.beforeCallback.call(this),!this.queue.length)throw"Tiq: Empty queue";return this.timer=setTimeout(function i(){if(!e.shouldPlay)return e.stop();var n=e.queue[++e.current][1];if(t===n?u++:u=0,n&&n.call(e,e.current,u,o),e.eachCallback&&e.eachCallback.call(e,e.current,u,o),o++,e.current+1===e.queue.length){if(1!==e.numberOfLoops&&e.eachLoopCallback&&e.eachLoopCallback.call(e,r),++r===e.numberOfLoops)return e.afterCallback&&e.afterCallback.call(e,o,r),e.stop();t=null,e.current=-1}else t=n;e.timer=setTimeout(i,e.queue[e.current+1][0])},e.queue[0][0]),this},r.prototype.loop=function(t){return this.numberOfLoops=t||-1,this},r.prototype.stop=function(){return this.shouldPlay=!1,this.numberOfLoops=0,clearTimeout(this.timer),this},r.prototype.repeat=function(t,e,o){return this.add(t,e,o)},["eachLoop","each","before","after"].forEach(function(t){r.prototype[t]=function(e){return o.call(this,t+"Callback",e)}}),"undefined"!=typeof module&&module.exports?module.exports=r:window.Tiq=r}();